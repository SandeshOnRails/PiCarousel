var fs = require("fs");
var path = require("path");
var _ = require("underscore");
var curDir = "/";
//获取列表
function getTree(root) {
    var files = [];
    var fileItems;
    curDir = root?root:curDir;
    
    if (!fs.existsSync(curDir)) {
        throw "Can't find folder";
        return;
    }
    var stat = fs.statSync(curDir);
    
    if (stat.isDirectory()) {
        fileItems = fs.readdirSync(curDir);
        if(curDir!="/"){
            files.push({
                name : "..",
                path : path.join(curDir, ".."),
                icon : "icon-arrow-up",
                type : "folder"
            });
        }
        _.each(fileItems, function(name) {
            var p = path.join(curDir, name);
            var s = fs.statSync(p);
            var isD = s.isDirectory();
            var icon = isD ? "icon-folder-open" : "icon-file";
            var type = isD ? "folder" : "file";
            if(name.indexOf(".")==0)return;
            files.push({
                name : name,
                path : p,
                icon : icon,
                type : type
            });
        });
    }
    
    return {
        files:files,
        cur:curDir
    }
}

module.exports.getTree = getTree;
